# AI Agent Guidelines for rss_mcp

## I. プロジェクトの概要とAIエージェントへの指示

このドキュメントは、本プロジェクトにおける開発、テスト、および品質保証のベストプラクティスを、AIコーディングエージェント（以下「エージェント」）が理解できるように明確に定義したものです。エージェントは、このガイドラインに従うことで、人間と協力して一貫性のある高品質なコードを生成する、頼れるチームメイトとして機能します。

## II. 開発環境のセットアップ

本プロジェクトは、効率性と再現性を最優先とする、`uv`を中心とした現代的なワークフローを採用しています。

### 仮想環境の作成と依存関係の管理

* `uv`は`pip`、`virtualenv`、`pipenv`の代替ツールであり、これらを単一の高速なバイナリに統合します。

### 主要コマンド

1.  **仮想環境の作成**:

   ```bash
   uv venv .venv
   ```

   これはプロジェクトルートに`.venv`仮想環境を迅速に作成します。　　

2.  **依存関係の追加**:

   ```bash
   uv add {package_name} --dev
   ```

   このコマンドは`pyproject.toml`ファイルに直接依存関係を追加します。

3. **環境の再現（ロックファイルの生成）**:

   ```bash
   uv pip compile pyproject.toml -o requirements.txt
   ```

   このコマンドは、`pyproject.toml`に記載された直接的な依存関係だけでなく、すべての**推移的な（間接的な）依存関係**も固定し、`requirements.txt`に書き出します。これにより、すべての開発者およびCI/CDパイプラインで完全に再現可能な環境が保証されます。

4. **依存関係のインストール/同期**:

   ```bash
   uv pip sync requirements.txt
   ```

   このコマンドは、`requirements.txt`の内容と環境を正確に一致させます。

## III. コード品質保証

### 静的解析と自動整形

* **ツール**: `ruff`
* **目的**: `ruff`は、高速なリンター兼フォーマッターとして、`Flake8`や`black`などの複数のツールの機能を統合します。
* **コマンド**:

  ```bash
  # コードの静的解析
  ruff check .
  # コードの自動整形
  ruff format .
  ```

* **設定**: pyproject.tomlでruffのルールを管理します。

#### **型チェック**

* **ツール**: mypy  
* **目的**: 型ヒントに従って、コードに型エラーがないかチェックします。

**方針（段階的タイピング）**:

* 本プロジェクトは「厳格すぎない型運用」を重視しており、すべてのコードに厳密な型を強制するわけではありません。型エラーは警告レベル。Any型や型省略も柔軟に許容します。  
* エージェントは、新しく生成するコードや、コアとなるロジックには積極的に型ヒントを追加して下さい。  
* 既存のコードベースに型を段階的に追加する場合は、pyproject.tomlの\[mypy-mycode.my\_module\]セクションや、\# type: ignoreコメントを使用して、特定のモジュールのエラーを抑制して構いません。

### **IV. テストと自動化**

* **テストフレームワーク**: pytest  
* **目的**: 単体テストと結合テストを記述し、実行します。
* **コマンド**:  

  ```Bash  
  pytest
  ```

### **V. ドキュメント管理**

エージェントは、ドキュメントを参照・更新・作成を行い、常に最新の状況を把握して実装を進めます。

* **directory**: ドキュメントはmarkdown形式で ./docs に設置します。ドキュメントがない場合は、実際のコーディング前に詳細を検討し作成します。
* **要件定義** : requirement.md
* **実装設計** : design.md
* **ToDo管理** : todo.md
* **参考資料** : reference.md (必要に応じて)

### **VI. セキュリティポリシーとベストプラクティス**

エージェントは、以下のセキュリティ原則を厳守して下さい。

* **ユーザー入力**: 常にユーザー入力をサニタイズし、検証します。  
* **データベース**: データベースクエリには、SQLインジェクション攻撃を防ぐために、**常にパラメータ化されたSQLを使用**して下さい。  
* **シークレット**: 環境変数や専用のシークレット管理ツールを使用し、**シークレットや認証情報をハードコードしないで下さい**。gitで  
* **依存関係**: Dependabotが作成する依存関係更新PRをレビューし、既知の脆弱性がないか確認して下さい。

### **VII. 貢献ガイドライン**

エージェントは、以下のガイドラインに従ってプルリクエストを作成して下さい。

* **ブランチ**: mainブランチから新しいフィーチャーブランチを作成します。  
* **コミットメッセージ**: コミットメッセージは、命令形で簡潔に記述します（例: Fix bug in auth module）。  
* **レビュー**: プルリクエストのレビュープロセスを尊重し、建設的なフィードバックに対応して下さい。  
* **テスト**: 変更を提出する前に、必ずローカルでテストを実行します。
